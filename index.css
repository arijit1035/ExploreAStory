@import url(https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css);
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

:root {
  --md-sys-color-primary: #006494;
  --md-sys-color-on-primary: #ffffff;
  --md-sys-color-primary-container: #cae6ff;
  --md-sys-color-on-primary-container: #001e30;
  --md-sys-color-secondary: #50606e;
  --md-sys-color-on-secondary: #ffffff;
  --md-sys-color-tertiary: #65597b;
  --md-sys-color-on-tertiary: #ffffff;
  --md-sys-color-error: #ba1a1a;
  --md-sys-color-background: #fcfcff;
  --md-sys-color-on-background: #1a1c1e;
  --md-sys-color-surface: #fcfcff;
  --md-sys-color-on-surface: #1a1c1e;
  --md-sys-color-surface-variant: #dde3ea;
  --md-sys-color-on-surface-variant: #41484d;
  --md-sys-color-outline: #71787e;
  --md-sys-color-shadow: #000000;
  --md-sys-elevation-level-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
  --md-sys-elevation-level-2: 0px 2px 6px 2px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
  --md-sys-elevation-level-3: 0px 1px 3px 0px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
}


/* Global reset and base font styles */
* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
  font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Oxygen, Cantarell,
    'Open Sans', 'Helvetica Neue', sans-serif;
}

html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  background-color: var(--md-sys-color-background);
  overflow: hidden; /* Prevent body scroll */
}

/* Top Header */
#top-header {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  padding: 16px;
  display: flex;
  align-items: center;
  z-index: 11;
  pointer-events: none; /* Allow clicks to pass through to the map */
}
#app-title {
  font-size: 24px;
  font-weight: 700;
  color: var(--md-sys-color-on-background);
  margin-left: 12px;
  text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
  pointer-events: auto;
}
#menu-toggle-button {
  background: var(--md-sys-color-surface);
  border: 1px solid var(--md-sys-color-outline);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: var(--md-sys-elevation-level-2);
  transition: all 0.2s ease;
  font-size: 18px;
  color: var(--md-sys-color-on-surface-variant);
  pointer-events: auto;
}
#menu-toggle-button:hover {
  box-shadow: var(--md-sys-elevation-level-3);
  background-color: var(--md-sys-color-surface-variant);
}


/* Styles for the main map container */
.map-container {
  color: var(--md-sys-color-on-background);
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  transition: width 0.3s ease, left 0.3s ease;
  overflow: hidden;
}

#map { height: 100%; width: 100%; }

/* Left Controls Panel */
#left-panel {
  position: fixed;
  top: 0;
  left: 0;
  width: 360px;
  height: 100%;
  background-color: var(--md-sys-color-surface);
  z-index: 10;
  box-shadow: var(--md-sys-elevation-level-2);
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 24px;
  padding-top: 80px; /* Space for top header */
  transform: translateX(-100%);
  transition: transform 0.3s ease;
}
#left-panel.visible {
  transform: translateX(0);
}

.main-chat-bar {
  display: flex;
  align-items: flex-start;
  background-color: var(--md-sys-color-surface);
  border-radius: 28px;
  padding: 8px;
  box-shadow: var(--md-sys-elevation-level-2);
  border: 1px solid var(--md-sys-color-outline);
  width: 100%;
}

#main-chat-input {
  flex: 1;
  border: none;
  outline: none;
  font-size: 16px;
  resize: none;
  line-height: 24px;
  max-height: 120px;
  background: transparent;
  color: var(--md-sys-color-on-surface);
  padding: 4px 12px;
}

#main-chat-send {
  background-color: var(--md-sys-color-primary);
  color: var(--md-sys-color-on-primary);
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.2s;
  position: relative;
  flex-shrink: 0;
}

#main-chat-send:hover { background-color: #00537a; }

.main-chat-options {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 16px;
}

/* Mode Toggle Styles */
.mode-toggle {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 12px;
  background: var(--md-sys-color-surface);
  border: 1px solid var(--md-sys-color-outline);
  border-radius: 24px;
  color: var(--md-sys-color-on-surface-variant);
  font-weight: 500;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  width: fit-content;
}

.mode-label { font-size: 14px; }
.switch { position: relative; display: inline-block; width: 46px; height: 24px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--md-sys-color-surface-variant); transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: var(--md-sys-color-on-primary); transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: var(--md-sys-color-primary); }
input:checked + .slider:before { transform: translateX(22px); }


/* Preferences Panel */
.preferences-panel {
  display: none; /* Hidden by default */
  background-color: var(--md-sys-color-surface);
  border: 1px solid var(--md-sys-color-outline);
  border-radius: 16px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  box-shadow: var(--md-sys-elevation-level-1);
}

.preference-item {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.preference-label {
  font-size: 13px;
  font-weight: 500;
  color: var(--md-sys-color-on-surface-variant);
}

#meal-budget-value {
  font-weight: 700;
  color: var(--md-sys-color-primary);
}

/* Transport selector styles */
.transport-selector {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}
.transport-option input[type="checkbox"] { display: none; }
.transport-option span {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  background-color: var(--md-sys-color-surface-variant);
  color: var(--md-sys-color-on-surface-variant);
  padding: 6px 12px;
  border-radius: 18px;
  border: 1px solid transparent;
  transition: all 0.2s ease;
  cursor: pointer;
}
.transport-option:hover span { background-color: var(--md-sys-color-outline); color: var(--md-sys-color-surface); }
.transport-option input:checked + span { background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); font-weight: 500; }

input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 8px;
  background: var(--md-sys-color-surface-variant);
  outline: none;
  border-radius: 4px;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  background: var(--md-sys-color-primary);
  cursor: pointer;
  border-radius: 50%;
}
input[type="range"]::-moz-range-thumb {
  width: 20px;
  height: 20px;
  background: var(--md-sys-color-primary);
  cursor: pointer;
  border-radius: 50%;
}


/* Travel Diary Panel */
.diary-container {
  position: fixed;
  top: 0;
  right: 0;
  width: 360px;
  height: 100%;
  background-color: var(--md-sys-color-surface);
  box-shadow: var(--md-sys-elevation-level-2);
  z-index: 1000;
  overflow: hidden;
  display: none;
  transform: translateX(100%);
  transition: transform 0.3s ease;
}
.diary-container.left { left: 0; right: auto; transform: translateX(-100%); }
.diary-container.visible { transform: translateX(0); }
.diary-header { padding: 16px; display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 1px solid var(--md-sys-color-outline); position: sticky; top: 0; background-color: var(--md-sys-color-surface); z-index: 2; }
.diary-header h3 { font-size: 18px; font-weight: 500; color: var(--md-sys-color-on-surface); }
.total-duration { font-size: 13px; font-weight: 500; color: var(--md-sys-color-primary); background-color: var(--md-sys-color-primary-container); padding: 2px 8px; border-radius: 10px; margin-top: 4px; display: inline-block; }
.diary-actions { display: flex; gap: 8px; }
.diary-header-button { background: none; border: none; cursor: pointer; font-size: 16px; color: var(--md-sys-color-on-surface-variant); display: flex; align-items: center; justify-content: center; padding: 6px; width: 32px; height: 32px; border-radius: 50%; transition: background-color 0.2s; }
.diary-header-button:hover { background-color: var(--md-sys-color-surface-variant); color: var(--md-sys-color-on-surface-variant); }
.diary-header-button:disabled { color: #ccc; cursor: not-allowed; }
.diary { padding: 0 16px 16px; overflow-y: auto; height: calc(100% - 75px); }
.map-overlay.visible:not(.modal-overlay) { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4); z-index: 999; display: block; }
.diary-item { display: flex; margin: 16px 0; position: relative; }
.diary-time { flex: 0 0 80px; font-weight: 500; color: var(--md-sys-color-on-surface); font-size: 14px; text-align: right; padding-right: 16px; padding-top: 2px; }
.diary-connector { flex: 0 0 20px; display: flex; flex-direction: column; align-items: center; }
.diary-dot { width: 12px; height: 12px; border-radius: 50%; background-color: var(--md-sys-color-primary); z-index: 1; margin-top: 4px; }
.diary-line { width: 2px; flex-grow: 1; background-color: var(--md-sys-color-outline); position: absolute; top: 16px; bottom: -16px; left: 89px; z-index: 0; }
.diary-item:last-child .diary-line { display: none; }
.diary-content { flex: 1; background-color: transparent; border-radius: 8px; padding: 12px; border: 1px solid var(--md-sys-color-outline); cursor: pointer; transition: background-color 0.2s, box-shadow 0.2s; }
.diary-content:hover { background-color: var(--md-sys-color-primary-container); }
.diary-content.active { border-left: 3px solid var(--md-sys-color-primary); background-color: var(--md-sys-color-primary-container); }
.diary-title { font-weight: 500; font-size: 15px; margin-bottom: 4px; color: var(--md-sys-color-on-surface); }
.diary-description { font-size: 13px; color: var(--md-sys-color-on-surface-variant); line-height: 1.5; margin-bottom: 8px; }
.diary-duration { display: inline-block; font-size: 12px; color: var(--md-sys-color-primary); background-color: var(--md-sys-color-primary-container); padding: 2px 6px; border-radius: 4px; margin-top: 8px; font-weight: 500; }
.diary-empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; padding: 20px; color: var(--md-sys-color-on-surface-variant); }
.diary-empty-state .fas { font-size: 48px; margin-bottom: 16px; color: var(--md-sys-color-surface-variant); }
.diary-empty-state h4 { font-size: 16px; font-weight: 500; color: var(--md-sys-color-on-surface); margin-bottom: 8px; }

/* Diary Content: Notes, Scans */
.diary-section { margin-top: 12px; padding-top: 12px; border-top: 1px dashed var(--md-sys-color-surface-variant); }
.diary-section-title { font-size: 13px; font-weight: 500; margin-bottom: 8px; color: var(--md-sys-color-secondary); }
.diary-notes textarea { width: 100%; border: 1px solid var(--md-sys-color-outline); border-radius: 8px; padding: 8px; font-size: 13px; min-height: 60px; resize: vertical; background-color: var(--md-sys-color-secondary); }
.diary-scans-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 8px; }
.scan-item { position: relative; cursor: pointer; }
.scan-item img { width: 100%; height: 60px; object-fit: cover; border-radius: 8px; }
.scan-item:hover::after { content: attr(data-description); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background-color: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px; white-space: nowrap; z-index: 10; margin-bottom: 5px; }
.diary-audiotour-list button { background: none; border: none; color: var(--md-sys-color-primary); cursor: pointer; font-size: 13px; text-align: left; padding: 4px 0; }
.diary-audiotour-list button:hover { text-decoration: underline; }

/* Card Carousel */
.card-carousel { position: absolute; bottom: 24px; left: 50%; transform: translateX(-50%); z-index: 10; width: 95%; max-width: 900px; display: none; }
.card-container { display: flex; overflow-x: auto; scroll-behavior: smooth; -ms-overflow-style: none; scrollbar-width: none; padding-bottom: 12px; -webkit-mask-image: linear-gradient(to right, transparent 0%, black 2%, black 98%, transparent 100%); mask-image: linear-gradient(to right, transparent 0%, black 2%, black 98%, transparent 100%); }
.card-container::-webkit-scrollbar { display: none; }
.location-card {
  flex: 0 0 auto;
  width: 280px;
  background-color: var(--md-sys-color-surface);
  border-radius: 16px;
  margin: 0 8px;
  box-shadow: var(--md-sys-elevation-level-1);
  overflow: visible; /* Changed to allow dropdowns */
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  position: relative;
  border: 1px solid var(--md-sys-color-outline);
  display: flex;
  flex-direction: column;
}
.location-card:hover { transform: translateY(-3px); box-shadow: var(--md-sys-elevation-level-2); }
.card-active { border: 2px solid var(--md-sys-color-primary); box-shadow: var(--md-sys-elevation-level-3); }
.card-image-container { height: 130px; background-color: var(--md-sys-color-surface-variant); overflow: hidden; border-radius: 16px 16px 0 0; }
.card-image { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease-out; }
.location-card:hover .card-image { transform: scale(1.05); }
.card-content { padding: 12px; flex-grow: 1; }
.card-title { font-size: 16px; font-weight: 500; margin-bottom: 4px; color: var(--md-sys-color-on-surface); }
.card-description { font-size: 13px; color: var(--md-sys-color-on-surface-variant); margin-bottom: 8px; line-height: 1.4; }
.card-time-badge { position: absolute; top: 10px; right: 10px; background-color: rgba(0,0,0,0.6); color: white; padding: 4px 10px; border-radius: 16px; font-size: 12px; font-weight: 500; z-index: 2; }
.card-sequence-badge { position: absolute; top: 10px; left: 10px; background-color: var(--md-sys-color-primary); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 500; z-index: 2; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
.card-duration { display: inline-block; font-size: 12px; color: var(--md-sys-color-primary); background-color: var(--md-sys-color-primary-container); padding: 2px 6px; border-radius: 4px; margin-top: 4px; font-weight: 500; }
.carousel-controls { display: flex; justify-content: center; align-items: center; margin-top: 16px; }
.carousel-arrow { background-color: var(--md-sys-color-surface); border: 1px solid var(--md-sys-color-outline); border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--md-sys-color-on-surface-variant); }
.carousel-arrow:hover { background-color: var(--md-sys-color-surface-variant); }
.carousel-indicators { display: flex; margin: 0 16px; }
.carousel-dot { width: 8px; height: 8px; border-radius: 50%; background-color: var(--md-sys-color-outline); margin: 0 4px; transition: background-color 0.2s; }
.carousel-dot.active { background-color: var(--md-sys-color-on-surface); }

/* Floating Action Buttons */
.fab {
  position: absolute;
  z-index: 10;
  background-color: var(--md-sys-color-surface);
  color: var(--md-sys-color-primary);
  border: 1px solid var(--md-sys-color-outline);
  border-radius: 16px;
  width: 56px;
  height: 56px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: var(--md-sys-elevation-level-2);
  transition: all 0.2s ease;
  font-size: 22px;
}
.fab:hover { box-shadow: var(--md-sys-elevation-level-3); }
#reset { bottom: 24px; right: 24px; }
#open-diary-button { bottom: 96px; right: 24px; background-color: var(--md-sys-color-primary-container); }

/* Card Actions: Dropdowns & Audio Player */
.card-actions { padding: 8px 12px 12px; display: flex; flex-direction: column; gap: 8px; }
.card-main-actions { display: flex; gap: 8px; }
.action-button { background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); border: none; border-radius: 20px; padding: 8px 12px; font-size: 13px; font-weight: 500; cursor: pointer; transition: background-color 0.2s; flex-grow: 1; display: flex; align-items: center; justify-content: center; gap: 6px; }
.action-button:hover { background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); }
.action-dropdown { position: relative; flex-grow: 1; }
.dropdown-menu { position: absolute; bottom: 110%; left: 0; background-color: var(--md-sys-color-surface); border-radius: 8px; box-shadow: var(--md-sys-elevation-level-2); z-index: 100; min-width: 200px; list-style: none; padding: 8px 0; display: none; }
.action-dropdown.show-menu .dropdown-menu { display: block; }
.dropdown-item { display: block; padding: 8px 16px; font-size: 14px; color: var(--md-sys-color-on-surface); text-decoration: none; cursor: pointer; }
.dropdown-item:hover { background-color: var(--md-sys-color-surface-variant); }
.dropdown-divider { height: 1px; background-color: var(--md-sys-color-outline); margin: 8px 0; }
.dropdown-sub-header { padding: 4px 16px 8px; font-size: 12px; color: var(--md-sys-color-on-surface-variant); font-weight: 500; }
.audio-tour-options .dropdown-item { display: inline-block; padding: 4px 12px; margin: 0 4px; border-radius: 12px; }
.audio-playback-container { padding: 4px; display: flex; align-items: center; gap: 8px; height: 32px; /* Reserve space */ }
.audio-playback-container .action-button { background-color: var(--md-sys-color-surface); color: var(--md-sys-color-primary); flex-grow: 0; padding: 6px 10px; }
.audio-progress-bar-container { flex-grow: 1; height: 6px; background-color: var(--md-sys-color-surface-variant); border-radius: 3px; overflow: hidden; }
.audio-progress-bar { height: 100%; width: 0%; background-color: var(--md-sys-color-primary); border-radius: 3px; transition: width 0.1s linear; }

/* Card/Diary Detail Items */
.card-details, .diary-details { display: flex; flex-direction: column; gap: 6px; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--md-sys-color-surface-variant); }
.card-detail-item, .diary-detail-item { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--md-sys-color-on-surface-variant); }
.card-detail-item .fas, .diary-detail-item .fas { width: 14px; text-align: center; color: var(--md-sys-color-secondary); }
.ticket-link {
  color: var(--md-sys-color-primary);
  text-decoration: none;
  font-weight: 500;
  transition: text-decoration 0.2s;
}
.ticket-link:hover { text-decoration: underline; }
.ticket-link .fas { margin-left: 4px; }

/* Street View & Tour */
.street-view-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; z-index: 2000; opacity: 1; transition: opacity 0.3s ease; }
.street-view-container.hidden { opacity: 0; pointer-events: none; }
#street-view-panorama { width: 100%; height: 100%; }
.close-street-view-button { position: absolute; top: 16px; right: 16px; z-index: 2003; background-color: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 24px; cursor: pointer; backdrop-filter: blur(4px); }
.tour-controls { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%); color: white; padding: 24px; z-index: 2002; display: flex; flex-direction: column; align-items: center; }
.tour-progress-bar-container { width: 100%; max-width: 600px; height: 4px; background-color: rgba(255,255,255,0.3); border-radius: 2px; margin-bottom: 12px; }
#tour-progress-bar { width: 0%; height: 100%; background-color: var(--md-sys-color-primary); border-radius: 2px; transition: width 0.3s ease; }
.tour-info { font-size: 18px; font-weight: 500; margin-bottom: 12px; text-shadow: 0 1px 4px #000; }
.tour-buttons { display: flex; gap: 24px; align-items: center; }
.tour-nav-button { background: rgba(0,0,0,0.5); border: none; color: white; width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; }
#tour-play-pause { width: 54px; height: 54px; font-size: 20px; }
.tour-nav-button:disabled { opacity: 0.5; cursor: not-allowed; }

/* Modal Styles (General) */
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4); display: flex; align-items: center; justify-content: center; z-index: 3000; opacity: 1; transition: opacity 0.3s ease; backdrop-filter: blur(5px); }
.modal-overlay.hidden { opacity: 0; pointer-events: none; }
.chat-container { width: 90%; max-width: 500px; height: 70%; max-height: 600px; background-color: var(--md-sys-color-surface); border-radius: 16px; box-shadow: var(--md-sys-elevation-level-3); display: flex; flex-direction: column; overflow: hidden; }
.chat-header { padding: 16px; border-bottom: 1px solid var(--md-sys-color-outline); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
.chat-header h4 { font-size: 16px; color: var(--md-sys-color-on-surface); font-weight: 500; }
.chat-header .close-button { font-size: 24px; background: none; border: none; cursor: pointer; color: var(--md-sys-color-on-surface-variant); }
.chat-messages { flex-grow: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 12px; }
.chat-message { display: flex; gap: 8px; max-width: 85%; }
.chat-message .bubble { padding: 10px 14px; border-radius: 18px; font-size: 14px; line-height: 1.5; word-wrap: break-word; }
.chat-message.ai { align-self: flex-start; }
.chat-message.ai .bubble { background-color: var(--md-sys-color-surface-variant); color: var(--md-sys-color-on-surface-variant); border-top-left-radius: 4px; }
.chat-message.user { align-self: flex-end; }
.chat-message.user .bubble { background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); border-top-right-radius: 4px; }
.chat-input-container { border-top: 1px solid var(--md-sys-color-outline); padding: 12px; display: flex; align-items: flex-start; gap: 8px; }
.chat-input-container textarea { flex-grow: 1; border: 1px solid var(--md-sys-color-outline); border-radius: 18px; padding: 8px 12px; font-size: 14px; resize: none; max-height: 100px; }
.chat-input-container .send-button { background-color: var(--md-sys-color-primary); color: white; border: none; border-radius: 50%; width: 36px; height: 36px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; }

/* Visual Search Modal */
#visual-search-modal .visual-search-container { max-width: 600px; width: 95%; background: var(--md-sys-color-surface); border-radius: 24px; overflow: hidden; }
.visual-search-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; border-bottom: 1px solid var(--md-sys-color-outline); }
.visual-search-header h4 { font-weight: 500; }
.visual-search-inner { position: relative; }
#visual-search-video { width: 100%; display: block; }
#visual-search-canvas { display: none; }
#visual-search-results { padding: 20px; font-size: 15px; line-height: 1.6; color: var(--md-sys-color-on-surface); }
.visual-search-footer { padding: 16px; text-align: center; }
#visual-search-capture { width: 64px; height: 64px; border-radius: 50%; border: 4px solid white; background: var(--md-sys-color-primary); cursor: pointer; box-shadow: 0 0 0 4px var(--md-sys-color-primary); }
#visual-search-spinner { border-top-color: var(--md-sys-color-primary); }
.results-mode #visual-search-video, .results-mode .visual-search-footer { display: none; }
.scanned-image-preview {
  width: 100%;
  max-height: 300px;
  object-fit: contain;
  border-radius: 12px;
  margin-bottom: 16px;
}
#visual-search-results p {
  padding: 0 20px;
  text-align: center;
}
.visual-search-results-actions {
  padding: 16px 20px;
  text-align: center;
  border-top: 1px solid var(--md-sys-color-outline);
  margin-top: 16px;
}

/* Welcome / Preferences Modal */
.welcome-container {
  width: 90%;
  max-width: 800px;
  max-height: 90vh;
  background-color: var(--md-sys-color-surface);
  border-radius: 24px;
  box-shadow: var(--md-sys-elevation-level-3);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.welcome-header {
  padding: 24px 32px;
  border-bottom: 1px solid var(--md-sys-color-outline);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-shrink: 0;
}
.welcome-header h2 {
  font-size: 22px;
  color: var(--md-sys-color-on-surface);
  font-weight: 500;
}
.skip-button {
  background: none;
  border: none;
  color: var(--md-sys-color-primary);
  font-weight: 500;
  font-size: 14px;
  cursor: pointer;
}
.skip-button:hover { text-decoration: underline; }
#preferences-form {
  padding: 16px 32px 32px;
  overflow-y: auto;
}
.question-group {
  margin-bottom: 24px;
}
.question-group p {
  font-weight: 500;
  font-size: 16px;
  margin-bottom: 12px;
  color: var(--md-sys-color-on-surface);
}
.options-group {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.options-group label {
  display: flex;
  align-items: center;
  cursor: pointer;
  font-size: 14px;
  color: var(--md-sys-color-on-surface-variant);
}
.options-group input[type="radio"],
.options-group input[type="checkbox"] {
  opacity: 0;
  width: 0;
  height: 0;
  position: absolute;
}
.options-group label span {
  position: relative;
  padding-left: 30px;
  transition: color 0.2s;
}
.options-group label:hover span {
  color: var(--md-sys-color-on-surface);
}
/* Custom radio/checkbox styles */
.options-group span::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 20px;
  height: 20px;
  border: 2px solid var(--md-sys-color-outline);
  background-color: var(--md-sys-color-surface);
  transition: all 0.2s ease;
}
.options-group input[type="radio"] + span::before {
  border-radius: 50%;
}
.options-group input[type="checkbox"] + span::before {
  border-radius: 4px;
}
.options-group span::after {
  content: '';
  position: absolute;
  left: 5px;
  top: 50%;
  transform: translateY(-50%) scale(0);
  width: 10px;
  height: 10px;
  background-color: var(--md-sys-color-on-primary);
  transition: all 0.2s ease;
}
.options-group input[type="radio"] + span::after {
  border-radius: 50%;
}
.options-group input[type="checkbox"] + span::after {
    left: 4px;
    width: 12px;
    height: 12px;
    background-color: transparent;
    border: solid var(--md-sys-color-on-primary);
    border-width: 0 3px 3px 0;
    transform: translateY(-60%) rotate(45deg) scale(0);
}

.options-group input:checked + span::before {
  background-color: var(--md-sys-color-primary);
  border-color: var(--md-sys-color-primary);
}
.options-group input:checked + span::after {
  transform: translateY(-50%) scale(1);
}
.options-group input[type="checkbox"]:checked + span::after {
    transform: translateY(-60%) rotate(45deg) scale(1);
}
.options-group input:checked + span {
    color: var(--md-sys-color-on-surface);
}
.submit-button {
  background-color: var(--md-sys-color-primary);
  color: var(--md-sys-color-on-primary);
  border: none;
  border-radius: 24px;
  padding: 12px 24px;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s;
  display: block;
  margin-top: 24px;
  width: 100%;
}
.submit-button:hover {
  background-color: #00537a;
}
.change-preferences-button {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  font-weight: 500;
  background-color: var(--md-sys-color-surface);
  color: var(--md-sys-color-primary);
  padding: 8px 16px;
  border-radius: 20px;
  border: 1px solid var(--md-sys-color-outline);
  cursor: pointer;
  transition: all 0.2s ease;
  width: fit-content;
}
.change-preferences-button:hover {
  background-color: var(--md-sys-color-primary-container);
  border-color: var(--md-sys-color-primary);
}


/* General utility styles */
.spinner { pointer-events: none; opacity: 1; position: absolute; left: calc(50% - 25px); top: calc(50% - 25px); width: 50px; height: 50px; border: 5px solid rgba(0, 0, 0, 0.1); border-top-color: var(--md-sys-color-primary); border-radius: 50%; animation: spin 1s linear infinite; transition: opacity 1s ease-in-out; }
.spinner.hidden { opacity: 0; }
.error { color: var(--md-sys-color-error); padding: 1em 0; text-align: center; }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

/* Loading state for main chat send button */
#main-chat-send.loading .fa-arrow-right { opacity: 0; }
#main-chat-send .spinner { position: absolute; width: 24px; height: 24px; border: 3px solid rgba(255, 255, 255, 0.3); border-top-color: white; opacity: 0; transition: opacity 0.2s; }
#main-chat-send.loading .spinner { opacity: 1; }

@media (max-width: 768px) {
  #left-panel { width: 90%; }
  .diary-container { width: 90%; }
  .preferences-panel { flex-direction: column; align-items: stretch; }
  .transport-selector { justify-content: center; }
}